  console.log
    Progress routes mounted

      at Object.<anonymous> (src/server.ts:35:9)

  console.log
    Profile routes mounted

      at Object.<anonymous> (src/server.ts:36:9)

FAIL src/tests/api_audit.test.ts (42.141 s)
  Profile & Progress API Audit
    GET /api/progress/weekly-xp
      Ã— should enforce auth (5007 ms)
      Ã— should return valid structure with valid token (5015 ms)
      Ã— should handle empty database gracefully (5003 ms)
    GET /api/progress/streak
      Ã— should return status 200 and an array of dates (5015 ms)
    GET /api/progress/subjects
      Ã— should return status 200 and subject stats (5013 ms)
    GET /api/profile/overview
      Ã— should return profile overview (5011 ms)
    GET /api/profile/timeline
      Ã— should return timeline array with limit (5013 ms)
    GET /api/profile/stats
      Ã— should return stats with corrected key (5004 ms)

  â— Profile & Progress API Audit â€º GET /api/progress/weekly-xp â€º should enforce auth

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 77 |[39m
     [90m 78 |[39m     describe([32m'GET /api/progress/weekly-xp'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 79 |[39m         it([32m'should enforce auth'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m         [31m[1m^[22m[39m
     [90m 80 |[39m             [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/progress/weekly-xp'[39m)[33m.[39mexpect([35m401[39m)[33m;[39m
     [90m 81 |[39m         })[33m;[39m
     [90m 82 |[39m[0m

      at src/tests/api_audit.test.ts:79:9
      at src/tests/api_audit.test.ts:78:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/progress/weekly-xp â€º should return valid structure with valid token

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 81 |[39m         })[33m;[39m
     [90m 82 |[39m
    [31m[1m>[22m[39m[90m 83 |[39m         it([32m'should return valid structure with valid token'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m         [31m[1m^[22m[39m
     [90m 84 |[39m             (prisma[33m.[39mactivity[33m.[39mfindMany [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockActivities)[33m;[39m
     [90m 85 |[39m             [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/progress/weekly-xp'[39m)[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid_token'[39m)[33m;[39m
     [90m 86 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m[0m

      at src/tests/api_audit.test.ts:83:9
      at src/tests/api_audit.test.ts:78:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/progress/weekly-xp â€º should handle empty database gracefully

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 91 |[39m         })[33m;[39m
     [90m 92 |[39m
    [31m[1m>[22m[39m[90m 93 |[39m         it([32m'should handle empty database gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m         [31m[1m^[22m[39m
     [90m 94 |[39m             (prisma[33m.[39mactivity[33m.[39mfindMany [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([])[33m;[39m
     [90m 95 |[39m             [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/progress/weekly-xp'[39m)[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid_token'[39m)[33m;[39m
     [90m 96 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m[0m

      at src/tests/api_audit.test.ts:93:9
      at src/tests/api_audit.test.ts:78:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/progress/streak â€º should return status 200 and an array of dates

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 100 |[39m
     [90m 101 |[39m     describe([32m'GET /api/progress/streak'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 102 |[39m         it([32m'should return status 200 and an array of dates'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 103 |[39m             [90m// Mock $queryRaw for the optimized implementation[39m
     [90m 104 |[39m             (prisma[33m.[39m$queryRaw [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([{ date[33m:[39m [32m'2023-12-01'[39m }[33m,[39m { date[33m:[39m [32m'2023-12-02'[39m }])[33m;[39m
     [90m 105 |[39m[0m

      at src/tests/api_audit.test.ts:102:9
      at src/tests/api_audit.test.ts:101:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/progress/subjects â€º should return status 200 and subject stats

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 113 |[39m
     [90m 114 |[39m     describe([32m'GET /api/progress/subjects'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 115 |[39m         it([32m'should return status 200 and subject stats'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 116 |[39m             [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/progress/subjects'[39m)[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid_token'[39m)[33m;[39m
     [90m 117 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 118 |[39m             expect(res[33m.[39mbody)[33m.[39mtoEqual({[0m

      at src/tests/api_audit.test.ts:115:9
      at src/tests/api_audit.test.ts:114:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/profile/overview â€º should return profile overview

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 125 |[39m
     [90m 126 |[39m     describe([32m'GET /api/profile/overview'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 127 |[39m         it([32m'should return profile overview'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 128 |[39m             (prisma[33m.[39muser[33m.[39mfindUnique [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m 129 |[39m             [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/profile/overview'[39m)[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid_token'[39m)[33m;[39m
     [90m 130 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m[0m

      at src/tests/api_audit.test.ts:127:9
      at src/tests/api_audit.test.ts:126:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/profile/timeline â€º should return timeline array with limit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 135 |[39m
     [90m 136 |[39m     describe([32m'GET /api/profile/timeline'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 137 |[39m         it([32m'should return timeline array with limit'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 138 |[39m             (prisma[33m.[39mactivity[33m.[39mfindMany [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockActivities)[33m;[39m
     [90m 139 |[39m             [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/profile/timeline'[39m)[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid_token'[39m)[33m;[39m
     [90m 140 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m[0m

      at src/tests/api_audit.test.ts:137:9
      at src/tests/api_audit.test.ts:136:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

  â— Profile & Progress API Audit â€º GET /api/profile/stats â€º should return stats with corrected key

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 145 |[39m
     [90m 146 |[39m     describe([32m'GET /api/profile/stats'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 147 |[39m         it([32m'should return stats with corrected key'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 148 |[39m             (prisma[33m.[39mactivity[33m.[39mcount [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([35m5[39m)[33m;[39m
     [90m 149 |[39m             (prisma[33m.[39muserBadge[33m.[39mcount [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([35m2[39m)[33m;[39m
     [90m 150 |[39m[0m

      at src/tests/api_audit.test.ts:147:9
      at src/tests/api_audit.test.ts:146:5
      at Object.<anonymous> (src/tests/api_audit.test.ts:73:1)

Test Suites: 1 failed, 1 total
Tests:       8 failed, 8 total
Snapshots:   0 total
Time:        42.371 s, estimated 43 s
Ran all test suites matching src/tests/api_audit.test.ts.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
