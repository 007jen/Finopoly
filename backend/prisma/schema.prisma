datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id        String   @id @default(uuid())
    clerkId   String   @unique
    email     String   @unique
    role      String   @default("Student") // "Student", "Partner", "admin"
    xp        Int      @default(0)
    streak    Int      @default(0)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    badges         Badge[]
    activities     Activity[]
    userBadges     UserBadge[]
    auditCases     AuditCase[]
    taxSimulations TaxSimulation[]
}

model Badge {
    id          String      @id @default(uuid())
    name        String
    description String
    icon        String?
    userId      String
    user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    earnedAt    DateTime    @default(now())
    userBadges  UserBadge[]
}

model CaseLaw {
    id            String   @id @default(uuid())
    title         String
    category      String
    difficulty    String
    xpReward      Int
    facts         String
    question      String
    options       String[]
    correctAnswer String
    explanation   String
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
}

model Activity {
    id          String   @id @default(uuid())
    type        String
    description String
    userId      String
    user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt   DateTime @default(now())
}

enum Role {
    student
    admin
}

enum Difficulty {
    Beginner
    Intermediate
    Pro
}

model UserBadge {
    id       String   @id @default(uuid())
    userId   String
    badgeId  String
    earnedAt DateTime @default(now())

    user  User  @relation(fields: [userId], references: [id])
    badge Badge @relation(fields: [badgeId], references: [id])

    @@unique([userId, badgeId])
}

model AuditCase {
    id          String     @id @default(uuid())
    title       String
    companyName String
    difficulty  Difficulty
    description String

    xpReward  Int     @default(150)
    timeLimit Int?
    isActive  Boolean @default(true)

    createdBy String?
    creator   User?   @relation(fields: [createdBy], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model TaxSimulation {
    id          String     @id @default(uuid())
    title       String
    description String
    difficulty  Difficulty
    scenario    String

    clientData Json
    questions  Json

    xpReward  Int     @default(200)
    timeLimit Int?
    isActive  Boolean @default(true)

    createdBy String?
    creator   User?   @relation(fields: [createdBy], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
